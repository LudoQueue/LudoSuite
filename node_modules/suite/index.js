var game_socket = null,
	all_players,
	player_sockets = {};

exports.config_game = function(socket) {
	if(game_socket == null) {
		game_socket = socket;
		socket.on('disconnect', function() {
			game_socket = null;
		});
		
		socket.on('game_state_change', function(new_state) {
			all_players.emit('player_state',new_state);
		});
		
		socket.on('player_in_game', function(data) {
			if(player_sockets.hasOwnProperty(data.id)) {
				player_sockets[data.id].emit('game_entered',data);
			}
		});
	}
	else {
		socket.emit('err', {message: 'A game already exists'});
	}
}

exports.config_player = function(config) {
	if(game_socket == null) {
		config.socket.emit('err', {message: 'Sorry, there is currently no game to connect to'});
	}
	else {
		
		player_sockets[config.id] = config.socket;
		
		config.socket.on('enter', function(data) {
			game_socket.emit('player_enter', {id: config.id, name: data});
		});
		
		config.socket.on('tilt', function(data) {
			game_socket.emit('player_tilt', {id: config.id, tilt: data});
		});
		
		config.socket.on('disconnect', function() {
			game_socket.emit('player_exit', config.id);
			delete player_sockets[config.id];
		});
		
	}
}

exports.set_all_players = function(sockets) {
	all_players = sockets;
}